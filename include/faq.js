const soonAnswer = "Скоро тут будет ответ";
const faqs_id = [
  {q:"Нужна ли виза гражданам РФ, РБ, СНГ для въезда на Бали и можно ли оформить её по прилёту?",a:"Да, для въезда на Бали нужна виза. Граждане России, Беларуси и СНГ могут оформить визу прямо по прилёту (VOA) — в аэропорту есть специальное окно. Чтобы всё прошло ещё быстрее и без нервов, можем оформить визу заранее онлайн."},
  {q:"Чем отличается VOA в аэропорту от электронной e-VOA и какой вариант удобнее?",a:"VOA — это очередь в аэропорту, заплатил и сразу получил визу. e-VOA — делаешь всё онлайн заранее, прилетаешь с готовой визой и просто проходишь паспортный контроль. Если не хочешь тратить время по прилёту — закажи e-VOA у нас, поможем всё сделать за час."},
  {q:"Как оформить e-VOA онлайн: на каком сайте, какие документы нужны и сколько времени занимает процесс?",a:"Оформлять нужно на официальном сайте evisa.imigrasi.go.id. Нужны фото паспорта и селфи. Обычно занимает от 1 до 24 часов. Если не хочешь заморачиваться с анкетой и оплатой, просто пришли фото нам — всё сделаем за тебя."},
  {q:"Нужно ли при подаче на визу или продлении указывать обратный билет и как обойти это требование?",a:"Официально требуют бронь обратного билета, но никто не проверяет его после въезда. Мы бесплатно делаем бронирование для визы — никуда лететь не нужно, билет просто для оформления."},
  {q:"Как продлить визу онлайн на 30 дней: когда подаваться, сколько времени занимает и какие документы подготовить?",a:"Продлевать визу лучше за 7–10 дней до окончания. Нужны паспорт, виза и селфи. Всё можно сделать онлайн — просто напиши нам, продлим визу без очередей и бумажек."},
  {q:"С какого дня начинает действовать продление — с момента подачи, с окончания старой визы или со следующего дня после неё?",a:"Продление считается с даты окончания вашей текущей визы, а не с момента подачи заявки. То есть дни не теряются."},
  {q:"Сколько стоит штраф за просрочку визы и можно ли его избежать, подав заявку до окончания срока?",a:"Штраф — 1 миллион рупий (~$65) за каждый день просрочки. Если успеешь подать заявку до истечения срока — никакого штрафа не будет."},
  {q:"Какие варианты долгосрочных виз доступны без визарана (C1, D12, KITAS) и во сколько они обходятся?",a:"Есть визы C1, D12, KITAS. C1 — до 6 месяцев, D12 — инвестиционная на год, KITAS — рабочая или семейная, даёт право жить долго. Стоимость: C1 — от $350, D12 — от $490, KITAS — от $1,100. Мы поможем выбрать и оформить под ваши цели."},
  {q:"Какие финансовые документы нужны для получения визы C1 или D12 — подойдет ли скриншот баланса или нужна официальная выписка?",a:"Подходит обычный скриншот баланса или выписка из приложения банка. Главное, чтобы на счету была нужная сумма. Если сомневаешься — покажи нам, подскажем как сделать правильно."},
  {q:"Что делать, если сайт evisa.imigrasi.go.id не работает или не принимает карту при оплате?",a:"Проблема часто встречается — сайт глючит, карты не принимаются. В этом случае пиши нам, оформим всё через свой канал, тебе не нужно будет возиться с оплатой и переводами."},
  {q:"Как проверить статус продления или найти заявку по номеру паспорта в личном кабинете?",a:"В личном кабинете на сайте evisa.imigrasi.go.id по номеру паспорта можно отследить статус заявки. Если оформлял(а) визу через нас — просто напиши, мы проверим за тебя и сразу дадим ответ."},
  {q:"Нужно ли ездить в миграционный офис для продления VOA или достаточно онлайн-подачи?",a:"Для продления VOA раньше нужно было идти в офис, сейчас можно всё сделать онлайн — особенно если оформляешь через нас, никуда ехать не придётся."},
  {q:"Можно ли оплатить визу наличными в аэропорту старыми долларами и какие купюры принимают?",a:"В аэропорту принимают только свежие доллары (без пятен, разрывов, 2009 года и новее), крупные купюры. Старые и потрёпанные — не берут. Лучше поменять заранее или использовать карту."},
  {q:"Требуется ли заполнять e-CD и SATUSEHAT перед вылетом или это можно сделать в аэропорту?",a:"e-CD (таможенная декларация) и SATUSEHAT (медицинская анкета) желательно заполнить заранее онлайн — это сэкономит время. Если не успел(а) — можно заполнить и в аэропорту, но будет больше очередей. Мы можем прислать ссылки и инструкции, чтобы всё сделать за 5 минут."}
];
const faqs_vn = faqs_id.map(x=>({q:x.q.replace('Бали','Вьетнам'),a:soonAnswer}));
const faqs_th = faqs_id.map(x=>({q:x.q.replace('Бали','Таиланд'),a:soonAnswer}));
const faqs_my = faqs_id.map(x=>({q:x.q.replace('Бали','Малайзию'),a:soonAnswer}));
let faqs = faqs_id;
const grid = document.getElementById('faq-grid');

// WAVE-анимация цифр через setInterval
let waveIdx = 0;
let waveTimer = null;
function startWave() {
  clearInterval(waveTimer);
  const nums = document.querySelectorAll('.faq-num');
  if (!nums.length) return;
  waveIdx = 0;
  waveTimer = setInterval(() => {
    nums.forEach((el, i) => {
      el.classList.remove('active', 'near');
      if (i === waveIdx) {
        el.classList.add('active');
      } else if (i === (waveIdx - 1 + nums.length) % nums.length ||
                 i === (waveIdx + 1) % nums.length) {
        el.classList.add('near');
      }
    });
    waveIdx = (waveIdx + 1) % nums.length;
  }, 150);
}

function renderFaq() {
  grid.innerHTML = '';
  faqs.forEach((f,i)=>{
    const card = document.createElement('div');
    card.className = 'faq-card fadein';
    card.innerHTML = `
      <div class="faq-num">${i+1}</div>
      <div class="faq-q">${f.q}</div>
      <button class="faq-btn" type="button" data-idx="${i}">Показать ответ</button>
    `;
    grid.appendChild(card);
  });
  grid.querySelectorAll('.faq-btn').forEach(btn=>{
    btn.onclick = function() {
      const idx = this.getAttribute('data-idx');
      showAnswer(Number(idx));
    }
  });
  startWave();
}
renderFaq();

document.getElementById('country-select').addEventListener('change',function(){
  let val = this.value;
  if(val==='id') faqs=faqs_id;
  else if(val==='vn') faqs=faqs_vn;
  else if(val==='th') faqs=faqs_th;
  else if(val==='my') faqs=faqs_my;
  renderFaq();
});

function showAnswer(i) {
  document.getElementById('modal-title').textContent = `Вопрос #${i+1}`;
  document.getElementById('modal-answer').textContent = faqs[i].a;
  document.getElementById('faq-modal').classList.remove('hidden');
  document.body.style.overflow = 'hidden';
}
function closeModal() {
  document.getElementById('faq-modal').classList.add('hidden');
  document.body.style.overflow = '';
}